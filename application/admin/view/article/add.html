{extend name="base:base-add" /}
{block name="style"}
<link rel="stylesheet" type="text/css" href="__LIB__/markdown/lib/codemirror/codemirror.min.css">
<link rel="stylesheet" type="text/css" href="__LIB__/markdown/css/editormd.css">
{/block}
{block name="title"}
<title>添加文章</title>
{/block}
{block name="form"}
<form class="form form-horizontal" id="form-article-add" enctype="multipart/form-data">
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1"><span class="c-red">*</span>所属分类：</label>
        <div class="form-controls col-xs-8 col-sm-1">
                <span class="select-box">
                    <select name="category_id" class="select">
                        {notempty name="to_level"}
                        <option value="0">|-根分类</option>
                        {volist name="to_level" id="vo"}
                        <option value="{$vo.id}">|-{$vo.delimiter}{$vo.name}</option>
                        {/volist}
                        {else /}
                        <option value="0">├根分类</option>
                        {/notempty}
                </select>
                </span>
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1"><span class="c-red">*</span>文章标题：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <input type="text" class="input-text" value="" placeholder="" id="title" name="title">
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">副标题：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <input type="text" class="input-text" value="" placeholder="" id="ftitle" name="ftitle">
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">关键词：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <input type="text" class="input-text" value="" placeholder="" id="keywords" name="keywords">
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">描述：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <textarea name="description" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"></textarea>
            <p class="textarea-numberbar"><em class="textarea-length">0</em>/100</p>
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">状态：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <div class="radio-box">
                <input name="status" type="radio" id="1" value="1" checked>
                <label>正常</label>
            </div>
            <div class="radio-box">
                <input type="radio" id="2" name="status" value="2">
                <label>禁用</label>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">推荐：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <div class="radio-box">
                <input name="mark" type="radio" id="yes" value="2">
                <label for="yes">推荐</label>
            </div>
            <div class="radio-box">
                <input name="mark" type="radio" id="no" value="1" checked>
                <label for="no">不推</label>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <label for="thumbnail" class="form-label col-xs-4 col-sm-1">缩略图：</label>
        <div class="form-controls col-xs-8 col-sm-4">
            <span class="btn-upload">
                <a href="javascript:void(0);" onclick="add('插入图片','/{$backendPrefix}/static/image/list.html')"
                   class="btn btn-primary radius btn-upload"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
            </span>
            <div style="height: 310px;margin: 10px 0;" class="add-img">
                <img src="" class="img-responsive center-block"/>
                <input type="hidden" id="thumbnail" name="thumbnail" value="">
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">文章内容：</label>
        <div class="form-controls col-xs-11 col-sm-11">
            <div id="markdown">
                <textarea name='markdown' style="display:none;" placeholder="数据库features字段，使用html代码，li标签 "></textarea>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <label class="form-label col-xs-4 col-sm-1">参考文献：</label>
        <div class="form-controls col-xs-11 col-sm-11">
            <div id="refer">
                <textarea name='refer' style="display:none;" placeholder="数据库features字段，使用html代码，li标签 "></textarea>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
            <button class="btn btn-secondary radius add" type="button"><i class="Hui-iconfont">&#xe632;</i>
                保存
            </button>
        </div>
    </div>
</form>
{/block}
{block name="script"}
<script type="text/javascript" src="__LIB__/markdown/editormd.js"></script>
<script>
    /*资讯-添加*/
    function add(title, url) {
        var index = layer.open({
            type: 2,
            title: title,
            content: url,
            area: ['940px', '840px']
        });
    }

    var Editor;
    var markdown;
    var refer;
    $(function () {
        markdown = Editor = editormd("markdown", {
            width: "100%",
            height: 960,
            path: "__LIB__/markdown/lib/",
            htmlDecode: "style,script,iframe",
            tex: true,
            emoji: true,
            taskList: true,
            flowChart: true,
            sequenceDiagram: true,
            saveHTMLToTextarea: true,
            markdown: "##文章内容",
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "/{$backendPrefix}/aws/image/markdownUpload.html"
        });
        refer = Editor = editormd("refer", {
            width: "100%",
            height: 320,
            path: "__LIB__/markdown/lib/",
            htmlDecode: "style,script,iframe",
            tex: true,
            emoji: true,
            taskList: true,
            flowChart: true,
            sequenceDiagram: true,
            saveHTMLToTextarea: true,
            markdown: "##参考文献",
        });
    });
</script>
<script type="text/javascript">
    $(".add").click(function () {
        var postData = {};
        var data = $("form").serializeArray();
        $.each(data, function () {
            postData[this.name] = this.value
        });
        $.ajax({
            url: "/{$backendPrefix}/article/add.html",
            type: "post",
            data: postData,
            "success": function (result) {
                var msgData = JSON.parse(result);
                if (msgData.status === true) {
                    layer.msg(msgData.message, {icon: 1, time: 1000}, function () {
                        window.parent.location.href = msgData.url
                    })
                } else {
                    layer.msg(msgData.message, {icon: 5, time: 2000})
                }
            }
        }, JSON);
    });
</script>
{/block}